generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"

}

model Users {
  ID        Int            @id @default(autoincrement())
  username  String         @unique @db.VarChar(32)
  pwHashed  String         @db.VarChar(128)


  lvl       Int
  currXp    Int

  ownedTasks Tasks[]       @relation("OwnedTasks")
  orgMembers Org_Members[]
  ordering   Ordering[]
  subTaskMemberships SubTaskMember[]
}

model Org {
  ID        Int            @id @default(autoincrement())
  name      String         @unique @db.VarChar(32)

  members   Org_Members[]
  tasks     Tasks[]
}

model Org_Members {
  org_id   Int
  user_id  Int

  org      Org   @relation(fields: [org_id], references: [ID], onDelete: Cascade)
  user     Users @relation(fields: [user_id], references: [ID], onDelete: Cascade)

  @@id([org_id, user_id])
}

model Tasks {
  ID        Int       @id @default(autoincrement())
  owner_id  Int?
  org_id    Int?
  description String? 
  task_name String    @db.VarChar(32)
  deadline  DateTime
  urgency   Int

  owner     Users?    @relation("OwnedTasks", fields: [owner_id], references: [ID])
  org       Org?      @relation(fields: [org_id], references: [ID])
  subTask   Sub_Task[]
  ordering  Ordering[]
}

model Sub_Task {
  ID          Int       @id @default(autoincrement())
  description String?
  task_id     Int

  task        Tasks     @relation(fields: [task_id], references: [ID], onDelete: Cascade)

  // users on this subtask (via join table)
  members     SubTaskMember[]
}
model Ordering {
  user_id Int
  task_id Int
  ind     Int

  user    Users @relation(fields: [user_id], references: [ID], onDelete: Cascade)
  task    Tasks @relation(fields: [task_id], references: [ID], onDelete: Cascade)
  


  @@id([user_id, task_id])

}

model Levels {
  lvl   Int
  lvlXP Int

  @@id([lvl])
}


model SubTaskMember {
  subtask_id Int
  user_id    Int

  subtask    Sub_Task @relation(fields: [subtask_id], references: [ID], onDelete: Cascade)
  user       Users   @relation(fields: [user_id], references: [ID], onDelete: Cascade)

  @@id([subtask_id, user_id])
}